document.addEventListener("DOMContentLoaded",function(){const c=document.getElementById("event-date"),i=document.getElementById("competition-select"),r=document.querySelector(".challengetable table tbody");let s=null,l=null;const d=new Date().toISOString().split("T")[0];c.value=d;function u(e){fetch(`/viewer/competitions?date=${e}`).then(t=>t.json()).then(t=>{i.innerHTML="<option value=''>Выберите мероприятие</option>",t.competitions.forEach(o=>{const n=document.createElement("option");n.value=o.id,n.textContent=o.name,i.appendChild(n)}),t.competitions.length>0?(i.value=t.competitions[0].id,m(t.competitions[0].id)):(r.innerHTML="<tr><td colspan='100%'>Мероприятий нет</td></tr>",p())}).catch(t=>console.error("Ошибка загрузки мероприятий:",t))}function h(e){e&&fetch(`/viewer/data?competition_id=${e}`).then(t=>t.json()).then(t=>{if(t.challenges.length===0){r.innerHTML="<tr><td colspan='100%'>Нет данных</td></tr>";return}let o="<tr><th>Испытание</th>";t.teams.forEach(n=>{o+=`<th>${n.name}</th>`}),o+="</tr>",r.innerHTML=o,t.challenges.forEach(n=>{let a=`<tr><td>${n.title} (${n.location})</td>`;t.teams.forEach(L=>{var f,v;let g=((v=(f=t.scoresByChallenge[n.id])==null?void 0:f.teams[L.id])==null?void 0:v.total_score)||0;a+=`<td>${g}/${n.points}</td>`}),a+="</tr>",r.innerHTML+=a})}).catch(t=>console.error("Ошибка загрузки данных мероприятия:",t))}function E(e){p(),l=setInterval(()=>{h(e)},4e3)}function p(){l&&(clearInterval(l),l=null)}function m(e){s!==e&&(s=e,h(e),E(e))}c.addEventListener("change",()=>{u(c.value)}),i.addEventListener("change",()=>{m(i.value)}),u(d)});
